# kynship 🏗️

موقع إلكتروني متكامل لعرض وبيع منتجات الألوميتال باستخدام Next.js و Supabase.

## 🚀 المميزات الرئيسية

### ✅ الميزات المكتملة
- **الصفحة الرئيسية**: عرض المنتجات المميزة، فيديو المقدمة، إحصائيات الشركة
- **متجر إلكتروني**: عرض جميع المنتجات مع فلترة حسب الفئة والسعر والبحث
- **تفاصيل المنتج**: صفحة تفاصيل كاملة مع معرض صور ومواصفات ومنتجات مشابهة
- **سلة التسوق**: إضافة/حذف/تعديل المنتجات في السلة مع حفظ في المتصفح
- **نظام الطلبات**: إتمام الطلبات وحفظها في قاعدة البيانات
- **نظام المستخدمين**: تسجيل دخول، إنشاء حساب، تسجيل خروج مع Supabase Auth
- **لوحة التحكم**: لوحة تحكم كاملة للمدير (إدارة المنتجات، الطلبات، الإعدادات)
- **إعدادات الموقع**: تخصيص جميع إعدادات الموقع مع حفظ في قاعدة البيانات
- **رفع الملفات**: رفع الصور والفيديوهات إلى Supabase Storage
- **تصميم متجاوب**: يعمل على جميع الأجهزة (كمبيوتر، تابلت، موبايل)

## 🔧 حل مشكلة عدم ظهور التغييرات

### 🚨 **المشكلة المكتشفة:**
التعديلات في لوحة التحكم بتحفظ في قاعدة البيانات، لكن مش بتظهر في الصفحة الرئيسية.

### ✅ **الحل المطبق:**
تم إصلاح معالجة البيانات في `hooks/useSiteSettings.ts` بحيث:
1. يتعامل مع البيانات من Supabase بشكل صحيح
2. يحول البيانات للتنسيق المناسب لـ React
3. يدعم الـ Realtime updates

## 🛠️ التشغيل والتطوير

### متطلبات النظام
- Node.js 18+
- npm أو yarn
- حساب Supabase

### خطوات التشغيل

1. **تثبيت التبعيات:**
```bash
npm install
```

2. **إعداد متغيرات البيئة:**
انسخ ملف `.env.local.example` إلى `.env.local` وقم بتعديل القيم:
```bash
cp .env.local.example .env.local
```

3. **تشغيل المشروع:**
```bash
npm run dev
```

4. **فتح المتصفح:**
افتح `http://localhost:3000`

### إعداد Supabase

1. **إنشاء حساب Supabase:**
- اذهب إلى [supabase.com](https://supabase.com)
- أنشئ مشروع جديد

2. **الحصول على البيانات:**
- من لوحة التحكم، اذهب إلى Settings > API
- انسخ `SUPABASE_URL` و `SUPABASE_ANON_KEY` و `SERVICE_ROLE_KEY`

3. **إعداد قاعدة البيانات:**
- نفذ ملف `setup-complete.sql` في SQL Editor (الطريقة الأسهل)
- أو نفذ الملفات المنفصلة بالترتيب الصحيح

### ⚡ الإعداد السريع لقاعدة البيانات

#### **ملف واحد للإعداد الكامل (مُوصى به):**
```sql
-- انسخ محتوى ملف setup-complete.sql كاملاً
-- والصقه في Supabase SQL Editor واضغط Run مرة واحدة
```

**الملف يحتوي على:**
- ✅ جميع الجداول والحقول
- ✅ جميع الـ Functions والـ Triggers
- ✅ جميع Storage Buckets والـ Policies
- ✅ جميع إعدادات Realtime
- ✅ جميع الفهارس للأداء المحسن
- ✅ البيانات الافتراضية للموقع

**الخطوات:**
1. اذهب إلى Supabase Dashboard → SQL Editor
2. انسخ محتوى `setup-complete.sql` كاملاً
3. الصقه في المحرر واضغط **Run**
4. انتظر اكتمال التنفيذ (قد يستغرق دقيقة أو اثنتين)
5. قم بإنشاء Storage Buckets يدوياً في Dashboard → Storage

#### 📁 ملفات SQL المنفصلة (للمطورين المتقدمين):

إذا كنت تفضل التنفيذ خطوة بخطوة:

```bash
# 1. إنشاء الهيكل الأساسي
schema.sql

# 2. إعداد التخزين والصلاحيات
storage-policies.sql

# 3. تفعيل Realtime للجداول المتبقية
realtime-setup.sql
```

#### ⚠️ ملاحظات مهمة:

- **لا تنفذ `schema.sql` و `setup-complete.sql` معاً**
- **استخدم أحدهما فقط** (الأول أسهل والثاني أكثر تفصيلاً)
- تأكد من تفعيل RLS على جميع الجداول بعد التنفيذ
- قم بإنشاء Storage Buckets يدوياً في Supabase Dashboard

---
**🎉 باستخدام `setup-complete.sql`، قاعدة البيانات ستكون جاهزة في دقيقة واحدة فقط!**

4. **إعداد التخزين:**
- نفذ ملف `SUPABASE_STORAGE_SETUP.md` لإنشاء Buckets

## 🔧 استكشاف الأخطاء وحل المشاكل

### مشكلة: التغييرات مش بتظهر في الصفحة الرئيسية
**الحل:**
1. احذف localStorage من المتصفح (F12 > Application > Local Storage)
2. أعد تحميل الصفحة
3. تأكد من أن البيانات محفوظة في Supabase

### مشكلة: رسالة "فشل رفع الصورة"
**الحل:**
1. اذهب إلى Storage في Supabase
2. أنشئ Buckets: `images`, `logos`, `products`, `pages`, `videos`
3. نفذ البوليسيز من ملف `SUPABASE_STORAGE_SETUP.md`

### مشكلة: الصفحة بتعمل بس مش بتحفظ
**الحل:**
1. تأكد من تسجيل الدخول في لوحة التحكم
2. تأكد من أن لديك صلاحيات المدير
3. فحص Console في المتصفح للأخطاء

## 📊 قاعدة البيانات

### الجداول الرئيسية
- **profiles**: بيانات المستخدمين
- **products**: المنتجات (مطابخ، أبواب، شبابيك)
- **orders**: الطلبات
- **reviews**: المراجعات
- **contact_messages**: رسائل التواصل
- **faq**: الأسئلة الشائعة
- **site_settings**: إعدادات الموقع

## 🔧 الأوامر المتاحة

```bash
# تشغيل المطور
npm run dev

# بناء المشروع للإنتاج
npm run build

# تشغيل نسخة الإنتاج
npm run start

# فحص الكود
npm run lint
```

## 📱 المميزات المتقدمة

### نظام الملفات
- رفع الصور إلى Supabase Storage
- دعم الفيديوهات
- أحجام مختلفة للصور
- حذف الملفات القديمة

### إعدادات الموقع
- تخصيص الألوان
- تحديث معلومات التواصل
- إدارة السوشيال ميديا
- تحديث اللوجو والشعار

### لوحة التحكم
- إدارة المنتجات (إضافة/تعديل/حذف)
- عرض الطلبات وتغيير حالاتها
- إدارة المراجعات
- تخصيص إعدادات الموقع

## 🔐 الأمان

- مصادقة Supabase مع JWT
- حماية المسارات المحمية
- تشفير كلمات المرور
- حماية من CSRF

## 🚀 النشر على Vercel

### خطوات النشر السريع:

1. **اربط المستودع بـ Vercel**:
   - اذهب إلى [vercel.com](https://vercel.com)
   - اربط مستودع GitHub الخاص بك

2. **أضف متغيرات البيئة** في لوحة تحكم Vercel:
   ```
   NEXT_PUBLIC_SUPABASE_URL=your_actual_supabase_url
   NEXT_PUBLIC_SUPABASE_ANON_KEY=your_actual_supabase_anon_key
   SUPABASE_SERVICE_ROLE_KEY=your_actual_service_role_key
   NEXT_PUBLIC_SITE_URL=https://your-domain.vercel.app
   ```

3. **انشر تلقائياً**:
   - سيقوم Vercel بالنشر تلقائياً مع كل push
   - سيقوم بتشغيل `npm run build` لبناء المشروع

### الملفات المهمة لـ Vercel:

- ✅ `package.json` - محدث مع جميع التبعيات
- ✅ `next.config.js` - محدث للعمل مع أي مشروع Supabase
- ✅ `vercel.json` - إعدادات محسنة للنشر
- ✅ `tsconfig.json` - إعدادات TypeScript صحيحة
- ✅ `middleware.ts` - حماية المسارات محمية بشكل صحيح

### حل مشاكل Vercel الشائعة:

#### مشكلة: خطأ في البناء
**الحل**:
```bash
npm install --force
npm run build
```

#### مشكلة: متغيرات البيئة غير محددة
**الحل**:
- تأكد من إضافة جميع متغيرات البيئة في لوحة Vercel
- تأكد من أن `NEXT_PUBLIC_` مرئية للعميل

#### مشكلة: مشكلة في Supabase
**الحل**:
- تأكد من صحة URL ومفاتيح Supabase
- فعّل RLS على جميع الجداول
- فعّل الـ Storage Buckets

#### مشكلة: خطأ في Functions Runtime
**الحل**:
1. اذهب إلى Vercel Dashboard → Settings → Functions
2. اختر Node.js 20.x كـ Runtime
3. أعد نشر المشروع

**ملاحظة**: إذا واجهت مشاكل في runtime، يمكنك تعديل ملف `vercel.json` وإضافة:
```json
"functions": {
  "app/api/**/*.ts": {
    "runtime": "nodejs20.x"
  }
}
```

### فحص النشر:
1. اذهب إلى لوحة Vercel
2. انتظر اكتمال البناء
3. تأكد من عدم وجود أخطاء في Logs
4. اختبر جميع الصفحات والوظائف

---
**🎉 مبروك! مشروعك جاهز للنشر على Vercel بدون مشاكل!**

## 📚 التوثيق

- [`SETUP_DATABASE.md`](SETUP_DATABASE.md) - إعداد قاعدة البيانات
- [`SUPABASE_STORAGE_SETUP.md`](SUPABASE_STORAGE_SETUP.md) - إعداد التخزين

## 🐛 استكشاف الأخطاء

### مشكلة: "Objects are not valid as a React child"
**الحل**: تأكد من أن جميع القيم في إعدادات الموقع من نوع string وليست object

### مشكلة: الصور لا تظهر بعد الرفع
**الحل**: تأكد من إعداد Supabase Storage والبوليسيز بشكل صحيح

### مشكلة: الإعدادات لا تحفظ في قاعدة البيانات
**الحل**: تأكد من أن المستخدم مسجل الدخول وله صلاحيات المدير

## 🚧 التطوير المستقبلي

- [ ] نظام الدفع الإلكتروني
- [ ] تطبيق موبايل (PWA)
- [ ] نظام التقييمات والمراجعات
- [ ] قائمة الرغبات
- [ ] مقارنة المنتجات
- [ ] تحسين SEO
- [ ] نظام التنبيهات
- [ ] تقارير المبيعات

## 📄 الترخيص

هذا المشروع تعليمي ومفتوح المصدر.

## 👨‍💻 المطور

تم التطوير بواسطة Cascade AI

---

**استمتع باستخدام الموقع! 🎉**
